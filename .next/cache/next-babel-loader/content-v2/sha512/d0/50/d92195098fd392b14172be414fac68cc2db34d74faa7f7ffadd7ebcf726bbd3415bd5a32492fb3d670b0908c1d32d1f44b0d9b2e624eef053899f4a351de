{"ast":null,"code":"import axios from 'axios';\nimport * as allSettled from 'promise.allsettled';\nallSettled.shim();\nconst prodUrl = 'http://localhost:8080/api/';\nexport let loadedUrl = false;\nexport const axiosClient = axios.create({\n  baseURL: prodUrl,\n  headers: {\n    'Content-Type': 'application/json; charset=UTF-8'\n  }\n});\nexport const setAuthTokenHeaders = newToken => {\n  axiosClient.defaults.headers = {\n    authorization: newToken,\n    'Content-Type': 'application/json; charset=UTF-8'\n  };\n};\n/**\r\n * Finds the running dev server, if it's production it instantely sets the url.\r\n */\n\nexport const findDevServerUrl = async () => {\n  // Shortcut\n  return prodUrl;\n\n  if (loadedUrl) {\n    return axiosClient.defaults.baseURL;\n  }\n\n  if (false) {\n    loadedUrl = true;\n    return prodUrl;\n  }\n\n  const urlsToTry = ['http://localhost:8080/api/', 'http://192.168.0.227:8080/api/', 'http://192.168.0.203:8080/api/', 'http://10.0.2.2:8080/api/', 'https://ss.ew.r.appspot.com/api/', prodUrl];\n  return await new Promise((resove, reject) => {\n    Promise.allSettled(urlsToTry.map(url => axios.get(url, {\n      timeout: 250\n    }))).then(results => {\n      if (results.length === 0) {\n        console.error('Could not find any dev URL.');\n        reject();\n        return '';\n      } // Filter by success.\n\n\n      results = results.filter(r => r.status === 'fulfilled'); // Use the first one\n      // @ts-ignore\n\n      const baseUrl = results[0].value.config.url;\n      axiosClient.defaults.baseURL = baseUrl;\n      console.log('Using dev server: ' + baseUrl + ', (of ' + results.length + ' success)');\n      loadedUrl = true;\n      resove(baseUrl);\n    });\n  });\n};","map":{"version":3,"sources":["E:/projects/4.23/awake-nextjs-refactored1/src/utils/axios-client.ts"],"names":["axios","allSettled","shim","prodUrl","loadedUrl","axiosClient","create","baseURL","headers","setAuthTokenHeaders","newToken","defaults","authorization","findDevServerUrl","urlsToTry","Promise","resove","reject","map","url","get","timeout","then","results","length","console","error","filter","r","status","baseUrl","value","config","log"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,KAAKC,UAAZ,MAA4B,oBAA5B;AAEAA,UAAU,CAACC,IAAX;AAEA,MAAMC,OAAO,GAAG,4BAAhB;AACA,OAAO,IAAIC,SAAS,GAAG,KAAhB;AAEP,OAAO,MAAMC,WAAW,GAAGL,KAAK,CAACM,MAAN,CAAa;AACtCC,EAAAA,OAAO,EAAEJ,OAD6B;AAEtCK,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AAF6B,CAAb,CAApB;AAOP,OAAO,MAAMC,mBAAmB,GAAIC,QAAD,IAAsB;AACvDL,EAAAA,WAAW,CAACM,QAAZ,CAAqBH,OAArB,GAA+B;AAC7BI,IAAAA,aAAa,EAAEF,QADc;AAE7B,oBAAgB;AAFa,GAA/B;AAID,CALM;AAOP;AACA;AACA;;AACA,OAAO,MAAMG,gBAAgB,GAAG,YAA6B;AAC3D;AACA,SAAOV,OAAP;;AAEA,MAAIC,SAAJ,EAAe;AACb,WAAOC,WAAW,CAACM,QAAZ,CAAqBJ,OAA5B;AACD;;AAED,aAA2C;AACzCH,IAAAA,SAAS,GAAG,IAAZ;AACA,WAAOD,OAAP;AACD;;AAED,QAAMW,SAAS,GAAG,CAChB,4BADgB,EAEhB,gCAFgB,EAGhB,gCAHgB,EAIhB,2BAJgB,EAKhB,kCALgB,EAMhBX,OANgB,CAAlB;AASA,SAAO,MAAM,IAAIY,OAAJ,CAAY,CAACC,MAAD,EAASC,MAAT,KAAoB;AAC3CF,IAAAA,OAAO,CAACd,UAAR,CACEa,SAAS,CAACI,GAAV,CAAeC,GAAD,IAASnB,KAAK,CAACoB,GAAN,CAAUD,GAAV,EAAe;AAAEE,MAAAA,OAAO,EAAE;AAAX,KAAf,CAAvB,CADF,EAEEC,IAFF,CAEQC,OAAD,IAAa;AAClB,UAAIA,OAAO,CAACC,MAAR,KAAmB,CAAvB,EAA0B;AACxBC,QAAAA,OAAO,CAACC,KAAR,CAAc,6BAAd;AACAT,QAAAA,MAAM;AACN,eAAO,EAAP;AACD,OALiB,CAOlB;;;AACAM,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAgBC,CAAD,IAAOA,CAAC,CAACC,MAAF,KAAa,WAAnC,CAAV,CARkB,CAUlB;AACA;;AACA,YAAMC,OAAO,GAAGP,OAAO,CAAC,CAAD,CAAP,CAAWQ,KAAX,CAAiBC,MAAjB,CAAwBb,GAAxC;AAEAd,MAAAA,WAAW,CAACM,QAAZ,CAAqBJ,OAArB,GAA+BuB,OAA/B;AACAL,MAAAA,OAAO,CAACQ,GAAR,CACE,uBAAuBH,OAAvB,GAAiC,QAAjC,GAA4CP,OAAO,CAACC,MAApD,GAA6D,WAD/D;AAIApB,MAAAA,SAAS,GAAG,IAAZ;AAEAY,MAAAA,MAAM,CAACc,OAAD,CAAN;AACD,KAxBD;AAyBD,GA1BY,CAAb;AA2BD,CAjDM","sourcesContent":["import axios from 'axios'\r\nimport * as allSettled from 'promise.allsettled'\r\n\r\nallSettled.shim()\r\n\r\nconst prodUrl = 'http://localhost:8080/api/'\r\nexport let loadedUrl = false\r\n\r\nexport const axiosClient = axios.create({\r\n  baseURL: prodUrl,\r\n  headers: {\r\n    'Content-Type': 'application/json; charset=UTF-8',\r\n  },\r\n})\r\n\r\nexport const setAuthTokenHeaders = (newToken: string) => {\r\n  axiosClient.defaults.headers = {\r\n    authorization: newToken,\r\n    'Content-Type': 'application/json; charset=UTF-8',\r\n  }\r\n}\r\n\r\n/**\r\n * Finds the running dev server, if it's production it instantely sets the url.\r\n */\r\nexport const findDevServerUrl = async (): Promise<string> => {\r\n  // Shortcut\r\n  return prodUrl\r\n\r\n  if (loadedUrl) {\r\n    return axiosClient.defaults.baseURL\r\n  }\r\n\r\n  if (process.env.NODE_ENV === 'production') {\r\n    loadedUrl = true\r\n    return prodUrl\r\n  }\r\n\r\n  const urlsToTry = [\r\n    'http://localhost:8080/api/',\r\n    'http://192.168.0.227:8080/api/',\r\n    'http://192.168.0.203:8080/api/',\r\n    'http://10.0.2.2:8080/api/',\r\n    'https://ss.ew.r.appspot.com/api/',\r\n    prodUrl,\r\n  ]\r\n\r\n  return await new Promise((resove, reject) => {\r\n    Promise.allSettled(\r\n      urlsToTry.map((url) => axios.get(url, { timeout: 250 }))\r\n    ).then((results) => {\r\n      if (results.length === 0) {\r\n        console.error('Could not find any dev URL.')\r\n        reject()\r\n        return ''\r\n      }\r\n\r\n      // Filter by success.\r\n      results = results.filter((r) => r.status === 'fulfilled')\r\n\r\n      // Use the first one\r\n      // @ts-ignore\r\n      const baseUrl = results[0].value.config.url\r\n\r\n      axiosClient.defaults.baseURL = baseUrl\r\n      console.log(\r\n        'Using dev server: ' + baseUrl + ', (of ' + results.length + ' success)'\r\n      )\r\n\r\n      loadedUrl = true\r\n\r\n      resove(baseUrl)\r\n    })\r\n  })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}